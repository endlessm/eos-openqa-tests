#!/usr/share/openqa/script/load_templates
#
# Endless OS Machines, Products, TestSuites and JobTemplates
#
# Use load_templates to load the file into the database. This is done
# automatically by githook.cgi and eos-update-tests on the OpenQA server.
#
{
  # JobTemplates is a subset of the combination of
  # Machines × Products × TestSuites, chosen manually to reduce the
  # combinatorial explosion.
  # Please keep this in alphabetical order of test_suite*, with all variants of
  # a given test_suite grouped together so that cargo culting can be done from
  # one place only.
  #
  # *install_default_upload and live_default should be at the top, as they are
  # a bit special.
  JobTemplates => [
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "install_default_upload" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "install_default_upload" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "install_default_upload" },
    },
    # No *_full flavor of this, since only the ISO supports live boots:
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "live_default" },
    },

    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "control_center_about" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "control_center_about" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "control_center_about" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "desktop_chrome" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "desktop_chrome" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "desktop_chrome" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "desktop_chromium" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "desktop_chromium" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "desktop_chromium" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "desktop_encyclopedia" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "desktop_encyclopedia" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "desktop_encyclopedia" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "desktop_libreoffice_writer" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "desktop_libreoffice_writer" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "desktop_libreoffice_writer" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "desktop_history" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "desktop_history" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "desktop_history" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "desktop_dinosaurs" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "desktop_dinosaurs" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "desktop_dinosaurs" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "desktop_search" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "desktop_search" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "desktop_search" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "desktop_terminal" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "desktop_terminal" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "desktop_terminal" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "discovery_feed" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "discovery_feed" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "discovery_feed" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full",
        version => "*",
      },
      test_suite => { name => "install_flatpak" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_full_update",
        version => "*",
      },
      test_suite => { name => "install_flatpak" },
    },
    {
      machine    => { name => "64bit" },
      prio       => 10,
      product    => {
        arch    => "x86_64",
        distri  => "eos",
        flavor  => "base_iso",
        version => "*",
      },
      test_suite => { name => "install_flatpak" },
    },
  ],


  Machines => [
    {
      backend   => "qemu",
      name      => "64bit",
      settings  => [
        { key => "QEMUCPU", value => "Nehalem" },
        { key => "QEMUCPUS", value => "2"},
        { key => "QEMUVGA", value => "qxl"},
        { key => "QEMURAM", value => "2048"},
        { key => "PART_TABLE_TYPE", value => "mbr"},
        { key => "WORKER_CLASS", value => "qemu_x86_64" },
        { key => "QEMU_VIRTIO_RNG", value => "1" },
      ],
    },
    {
      backend   => "qemu",
      name      => "uefi",
      settings  => [
        { key => "QEMUCPU", value => "Nehalem" },
        { key => "QEMUCPUS", value => "2"},
        { key => "QEMUVGA", value => "qxl"},
        { key => "QEMURAM", value => "2048"},
        { key => "UEFI", value => "1"},
        { key => "PART_TABLE_TYPE", value => "gpt"},
        { key => "WORKER_CLASS", value => "qemu_x86_64" },
        { key => "QEMU_VIRTIO_RNG", value => "1"}
      ],
    },
    {
      backend   => "qemu",
      name      => "ARM",
      settings  => [
        { key => "QEMU", value => "arm" },
        { key => "QEMUCPUS", value => "2"},
        { key => "QEMUMACHINE", value => "virt"},
        { key => "QEMURAM", value => "1024"},
        { key => "QEMU_NO_KVM", value => "1"},
        { key => "TIMEOUT_SCALE", value => "5" },
        { key => "SERIALDEV", value => "ttyAMA0" },
        # we're running ARM tests on x86_64 for now as we have
        # no ARM workers
        { key => "WORKER_CLASS", value => "qemu_x86_64" },
        { key => "QEMU_VIRTIO_RNG", value => "1"}
      ],
    },
  ],


  # If introducing a new distribution, you need to create/symlink its tests in
  # /var/lib/openqa/share/tests/${distri} before it will work.
  Products => [
    {
      arch      => "x86_64",
      distri    => "eos",
      flavor    => "base_full",
      name      => "",
      version   => "*",
    },
    {
      arch      => "x86_64",
      distri    => "eos",
      flavor    => "base_iso",
      name      => "",
      version   => "*",
    },

    {
      arch      => "x86_64",
      distri    => "eosinstaller",
      flavor    => "base_full",
      name      => "",
      version   => "*",
    },
    {
      arch      => "x86_64",
      distri    => "eosnonfree",
      flavor    => "base_full",
      name      => "",
      version   => "*",
    },
    {
      arch      => "arm",
      distri    => "eosnonfree",
      flavor    => "base_full",
      name      => "",
      version   => "*",
    },

    # Update tests
    {
      arch      => "x86_64",
      distri    => "eos",
      flavor    => "base_full_update",
      name      => "",
      version   => "*",
    },
  ],


  TestSuites => [
    {
      name => "install_default",
      settings => [
      ],
    },
    {
      name => "live_default",
      settings => [
        { key => "LIVE", value => "1" },
      ],
    },
    {
      name => "install_default_upload",
      settings => [
        { key => "STORE_HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
        # Minimum HDD size we support on real machines.
        { key => "HDDSIZEGB", value => "32" },
      ],
    },
    {
      name => "control_center_about",
      settings => [
        { key => "POSTINSTALL", value => "control_center_about" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "desktop_chrome",
      settings => [
        { key => "POSTINSTALL", value => "desktop_chrome" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "desktop_chromium",
      settings => [
        { key => "POSTINSTALL", value => "desktop_chromium" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "desktop_encyclopedia",
      settings => [
        { key => "POSTINSTALL", value => "desktop_encyclopedia" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "desktop_libreoffice_writer",
      settings => [
        { key => "POSTINSTALL", value => "desktop_libreoffice_writer" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "desktop_history",
      settings => [
        { key => "POSTINSTALL", value => "desktop_history" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "desktop_dinosaurs",
      settings => [
        { key => "POSTINSTALL", value => "desktop_dinosaurs" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "desktop_search",
      settings => [
        { key => "POSTINSTALL", value => "desktop_search" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "desktop_terminal",
      settings => [
        { key => "POSTINSTALL", value => "desktop_terminal" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "discovery_feed",
      settings => [
        { key => "POSTINSTALL", value => "discovery_feed" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
    {
      name => "install_flatpak",
      settings => [
        { key => "POSTINSTALL", value => "install_flatpak" },
        { key => "START_AFTER_TEST", value => "install_default_upload" },
        { key => "BOOTFROM", value => "c" },
        { key => "HDD_1", value => "disk_%FLAVOR%_%MACHINE%.qcow2" },
      ],
    },
  ],
}
